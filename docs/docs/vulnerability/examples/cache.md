# Cache

## Clear Caches
The `--clear-cache` option removes caches.

**The scan is not performed.**

```
$ trivy image --clear-cache
```

<details>
<summary>Result</summary>

```
2019-11-15T15:13:26.209+0200    INFO    Reopening vulnerability DB
2019-11-15T15:13:26.209+0200    INFO    Removing image caches...
```

</details>

## Cache Directory
Specify where the cache is stored with `--cache-dir`.

```
$ trivy --cache-dir /tmp/trivy/ image python:3.4-alpine3.9
```

## Cache Backend
!!! warning "EXPERIMENTAL"
    This feature might change without preserving backwards compatibility.

Trivy supports local filesystem, Redis and S3 as the cache backend. This option is useful especially for client/server mode.

Three options:

- `fs`
    - the cache path can be specified by `--cache-dir`
- `redis://`
    - `redis://[HOST]:[PORT]`
    - TTL can be configured via `--cache-ttl`
- `s3://`
    - `s3://[bucket name]`
    - Custom S3 endpoint can be configured via `--s3-endpoint`

```
$ trivy server --cache-backend redis://localhost:6379
```

Trivy also support for connecting to Redis using TLS, you only need to specify `--redis-ca` , `--redis-cert` , and `--redis-key` option.

```
$ trivy server --cache-backend redis://localhost:6379 \
  --redis-ca /path/to/ca-cert.pem \
  --redis-cert /path/to/cert.pem \
  --redis-key /path/to/key.pem
```

TLS option for redis is hidden from Trivy command-line flag, but you still can use it.


Using On-premise S3 storage:

```
export AWS_REGION=us-east-1
export AWS_ACCESS_KEY_ID=keyid
export AWS_SECRET_ACCESS_KEY=accesskey
trivy server --cache-backend=s3://trivy-onprem --s3-endpoint=https://obj.toosecret.com
```

Using AWS default credential loader (credentials can be in environment variables or AWS metadata): 

```
trivy server --cache-backend=s3://trivy
```
